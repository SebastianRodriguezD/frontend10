(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const u=({text:e,fnc:r,className:n=""})=>{const t=document.createElement("button");return t.classList.add("main-button"),n&&t.classList.add(n),t.textContent=e,t.addEventListener("click",r),t},v=e=>{const r=document.querySelector("main"),n=document.createElement("div");return r.innerHTML="",n.id=e,r.append(n),n},p=(e,r)=>{e.preventDefault(),window.history.pushState("","",r.path),r.page()},T="https://backend10.vercel.app/",f=async({endpoint:e,method:r="GET",body:n,isJSON:t=!0,token:o=null})=>{const s={Authorization:`Bearer ${o}`};t&&(s["Content-type"]="application/json");const a=await fetch(T+e,{body:t?JSON.stringify(n):n,method:r,headers:s}),i=await a.json();return{ok:a.ok,status:a.status,data:i}},g=async()=>{const e=v("eventos"),n=(await f({endpoint:"/eventos",token:localStorage.getItem("token")})).data;for(const t of n){if(!t.titulo){console.error("Título del evento no definido:",t);continue}const o=document.createElement("div");o.classList.add("evento"),o.innerHTML=`
      <img src="${t.caratula}" alt="${t.titulo}">
      <h3>${t.titulo}</h3>
      <p>${t.fecha}</p>
      <p>${t.ciudad}</p>
    `;const s=t.info&&typeof t.info=="string"?t.info.substring(0,200):"Descripción no disponible",a=document.createElement("p");a.textContent=s,a.classList.add("descripcion"),a.style.display="none",o.appendChild(a);const i=u({text:"+ Info",fnc:()=>{a.style.display==="none"?(a.style.display="block",i.textContent="- Info"):(a.style.display="none",i.textContent="+ Info")}});o.appendChild(i);const c=document.createElement("input");c.type="checkbox";const d=`asistencia-${t.titulo.replace(/\s+/g,"-")}`;c.id=d;const m=document.createElement("div");m.classList.add("asistencia");const h=document.createElement("span");h.textContent="Asistir",h.style.marginLeft="8px",c.addEventListener("change",async I=>{I.target.checked?alert("¡Asistencia confirmada para el evento: "+t.titulo+"!"):alert("Has cancelado la asistencia para el evento: "+t.titulo)}),m.appendChild(c),m.appendChild(h),o.appendChild(m),e.appendChild(o)}},l=({labelText:e,type:r="text",required:n=!0,placeholder:t,isTextarea:o=!1,maxlength:s,id:a,name:i})=>{const c=a||e.replace(/\s+/g,"-").toLowerCase(),d=i||c;return`
    <div class="field-form">
      <label for="${c}">${e}</label>
      ${o?`<textarea id="${c}" name="${d}" ${t?`placeholder='${t}'`:""} ${s?`maxlength='${s}'`:""} ${n?"required":""}></textarea>`:`<input id="${c}" name="${d}" type='${r}' ${t?`placeholder='${t}'`:""} ${n?"required":""} />`}
    </div>`},L=e=>{e.className="login-form",e.innerHTML=`
    ${l({labelText:"Email",type:"email",required:!0,placeholder:"Ingresa tu email",id:"emailLogin",name:"EmailLogin"})}
    ${l({labelText:"Contraseña",type:"password",required:!0,placeholder:"Ingresa tu contraseña",id:"ContraseñaLogin",name:"ContraseñaLogin"})}
    
  `,e.append(u({text:"Iniciar sesión",fnc:()=>{},className:"button-login"}))},C=e=>{e.className="registro-form",e.innerHTML=`
     ${l({labelText:"Email",type:"email",required:!0,placeholder:"Ingresa tu email",id:"registro-email",name:"email-registro"})}
    ${l({labelText:"Contraseña",type:"password",required:!0,placeholder:"Ingresa tu contraseña",id:"registro-password",name:"registro-password"})}
    ${l({labelText:"Nombre",type:"text",required:!0,placeholder:"Ingresa tu nombre",id:"NombreRegistro",name:"NombreRegistro"})}
     ${l({labelText:"Aprellido",type:"text",required:!0,placeholder:"Ingresa tu apellido",id:"ApellidoRegistro",name:"ApellidoRegistro"})}
 
   
  `,e.append(u({text:"Registrar",fnc:()=>{},className:"button-registro"}))},E=async e=>{if(e.preventDefault(),localStorage.getItem("token")){alert("Ya hay una sesión activa.");return}const[n,t]=e.target,o={email:n.value,password:t.value},s=document.createElement("div");s.textContent="Cargando...",s.className="loading",document.body.appendChild(s);try{const a=await f({endpoint:"/users/login",body:o,method:"POST"});a&&a.data&&a.data.token?(localStorage.setItem("token",a.data.token),alert("Inicio de sesión con éxito."),p(e,{path:"/eventos",page:g})):(console.error("Inicio de sesión no fue exitoso:",a),alert("Error en el inicio de sesión. Por favor, verifica los datos introducidos."))}catch(a){console.error("Error en la solicitud:",a),alert("Hubo un problema con la solicitud. Por favor, inténtalo de nuevo más tarde.")}finally{s&&document.body.removeChild(s)}},$=async e=>{e.preventDefault();const[r,n,t,o]=e.target,s={userName:t.value,lastName:o.value,email:r.value,password:n.value},a=document.createElement("div");a.textContent="Registrando...",a.className="loading",document.body.appendChild(a);try{const i=await f({endpoint:"/users/register",body:s,method:"POST"});i&&i.data?(alert("Registro exitoso. Ahora puedes iniciar sesión."),p(e,{path:"/login",page:b})):(console.error("Error en el registro:",i),alert("Hubo un error al registrar. Por favor, intenta de nuevo."))}catch(i){console.error("Error en la solicitud:",i),alert("Hubo un problema con la solicitud. Por favor, inténtalo de nuevo más tarde.")}finally{a&&document.body.removeChild(a)}},N=e=>{e.preventDefault(),localStorage.removeItem("token"),alert("Has cerrado sesión con éxito."),p(e,{path:"/login",page:b})};let x=!0;const b=()=>{const e=v("Login");if(localStorage.getItem("token")){const n=u({text:"Cerrar sesión",fnc:N});e.append(n)}else{const n=document.createElement("form"),t=u({text:"Registrate si no tienes cuenta",fnc:()=>{x=!x,x?(L(n),t.textContent="Registrate si no tienes cuenta",n.removeEventListener("submit",$),n.addEventListener("submit",E)):(C(n),t.textContent="Inicia sesión si tienes cuenta",n.removeEventListener("submit",E),n.addEventListener("submit",$))}});L(n),n.addEventListener("submit",E),e.append(n),e.append(t)}},y=()=>{const e=v("Home"),r=document.createElement("h1");r.innerHTML='<span class="epoca">Epoca</span><span class="fest">Fest</span>';const n=document.createElement("h2");n.innerHTML="",n.textContent="¡Vive momentos inolvidables!",e.append(r),e.append(n);const t=document.createElement("div");t.className="divButton-Home",e.append(t),t.append(u({text:"Eventos",fnc:o=>{o.preventDefault(),p(o,{path:"/eventos",page:g})}})),t.append(u({text:"Inicia sesión",fnc:o=>{o.preventDefault(),p(o,{path:"/login",page:b})}}))},k=e=>{e.className="eventos-form",e.innerHTML=`
    ${l({labelText:"Nombre del evento",placeholder:"Escribe el nombre del evento"})}
    ${l({labelText:"Fecha del evento",type:"date",placeholder:"Selecciona la fecha"})}
    ${l({labelText:"Imagen del evento",placeholder:"URL de la imagen (obligatorio)"})}
    ${l({labelText:"Ciudad del evento",placeholder:"Escribe la ciudad"})}
      ${l({labelText:"Descripción breve del evento",isTextarea:!0,maxlength:150,required:!1,placeholder:"Máximo 150 caractecres"})}
  `,e.append(u({text:"Publicar Evento",fnc:()=>{},className:"button-post"}))},H=e=>{const r=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],n=new Date(e),t=n.getDate(),o=r[n.getMonth()],s=n.getFullYear();return`${t} de ${o} de ${s}`},w=async e=>{e.preventDefault();const[r,n,t,o,s]=e.target,a={titulo:r.value,fecha:H(n.value),caratula:t.value,ciudad:o.value,info:s.value};console.log("datos enviados",a);const i=localStorage.getItem("token");if(!i){console.log("Usuario no autenticado"),alert("Debes iniciar sesión para publicar un evento");return}try{const c=await f({endpoint:"/eventos",body:a,method:"POST",token:i});console.log("respueta del servidor",c),c.ok?(alert("Evento publicado con éxito"),p(e,{path:"/eventos",page:g})):(console.log("Error al publicar el evento",c),alert("Hubo un problema al publicar el evento"))}catch(c){console.error("Error en la solicitud:",c),alert("Ocurrió un error al intentar publicar el evento.")}},D=()=>{const e=v("PublicarEvento"),r=document.createElement("form"),n=u({text:"Eventos",fnc:t=>{t.preventDefault(),p(t,{path:"/eventos",page:g})}});k(r),r.addEventListener("submit",w),e.append(r),e.append(n)},P=[{path:"/home",text:"Home",page:y},{path:"/eventos",text:"Eventos",page:g},{path:"/postEventos",text:"Publicar Evento",page:D},{path:"/login",text:"Login",page:b}],M=()=>{const e=document.createElement("header"),r=document.createElement("nav"),n=document.createElement("img"),t=document.createElement("ul"),o=document.createElement("a"),s=document.createElement("button");s.className="abrir";const a=document.createElement("button");a.className="cerrar",s.innerHTML='<i class="bi bi-list"></i>',a.innerHTML='<i class="bi bi-x-square"></i>',o.className="aLogo",n.src="./src/assets/7aZlNY-LogoMakr.png",n.alt="Logo",n.className="logo",o.href="/home",o.addEventListener("click",i=>{i.preventDefault(),p(i,{path:"/home",page:y})});for(const i of P){const c=document.createElement("li"),d=document.createElement("a");d.addEventListener("click",m=>p(m,i)),d.textContent=i.text,d.href=i.path,c.append(d),t.append(c)}s.addEventListener("click",()=>{r.classList.add("visible")}),a.addEventListener("click",()=>{r.classList.remove("visible")}),e.append(o),e.append(s),e.append(r),o.append(n),r.append(a),r.append(t),document.body.append(e)},A=()=>{const e=document.createElement("main");document.body.append(e)};M();A();y();
